<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SpiritServer Control Panel</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/x-icon" href="/static/resources/favicon.ico">
  <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
  <script>

    async function wakeOnLan() {
      try {
        const response = await fetch('/wake', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const result = await response.json();
        alert(result.message || result.error);
      } catch (error) {
        alert(`Error: ${error}`);
      }
    }

    async function stopServer() {
      try {
        const response = await fetch('/stop', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const result = await response.json();
        alert(result.message || result.error);
      } catch (error) {
        alert(`Error: ${error}`);
      }
    }

    async function startServer() {
      try {
        const response = await fetch('/start', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const result = await response.json();
        alert(result.message || result.error);
      } catch (error) {
        alert(`Error: ${error}`);
      }
    }

    async function restartServer() {
      try {
        const response = await fetch('/restart', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const result = await response.json();
        alert(result.message || result.error);
      } catch (error) {
        alert(`Error: ${error}`);
      }
    }


    async function initSocket() {
      try {
        const response = await fetch('/socket-config');
        const config = await response.json();
        const socket = io(config.socket_url);

        socket.on('status_update', (data) => {
          const restartButton = document.getElementById('restartButton');
          const wakeOnLanButton = document.getElementById('wakeOnLanButton');
          const startButton = document.getElementById('startButton');
          const stopButton = document.getElementById('stopButton');

          if (data.host_status === 'online') {
            document.getElementById('host-status-icon').src = '/static/resources/online.png';
            wakeOnLanButton.disabled = true; // Disable Wake on LAN button when host is online
          } else {
            document.getElementById('host-status-icon').src = '/static/resources/offline.png';
            wakeOnLanButton.disabled = false; // Enable Wake on LAN button when host is offline
          }

          if (data.minecraft_status === 'online') {
            document.getElementById('minecraft-status-icon').src = '/static/resources/online.png';
            restartButton.disabled = false;
            startButton.disabled = true;
            stopButton.disabled = false;
          } else if (data.minecraft_status === 'loading') {
            document.getElementById('minecraft-status-icon').src = '/static/resources/loading.gif';
            restartButton.disabled = true;
            startButton.disabled = true;
            stopButton.disabled = true;
          } else {
            document.getElementById('minecraft-status-icon').src = '/static/resources/offline.png';
            restartButton.disabled = true;
            startButton.disabled = false;
            stopButton.disabled = true;
          }
    });
      } catch (error) {
        console.error('Error fetching socket configuration:', error);
      }
    }

    initSocket();
  </script>
</head>
<body>
<div class="page-wrapper">
  <div class="logo-container">
    <img src="/static/resources/jmglogo.png" alt="JMG Logo">
  </div>
  <div class="container">
    <div class="status">
      <h2>Host Machine Status: <img id="host-status-icon" src="/static/resources/loading.gif" alt="Host Status"></h2>
    </div>
    <div class="status">
      <h2>Minecraft Server Status: <img id="minecraft-status-icon" src="/static/resources/loading.gif" alt="Minecraft Status"></h2>
    </div>
    <div class="buttons">
      <button id="wakeOnLanButton" onclick="wakeOnLan()" disabled>Wake on LAN</button>
      <button id="startButton" onclick="startServer()" disabled>Start Server</button>
      <button id="stopButton" onclick="stopServer()" disabled>Stop Server</button>
      <button id="restartButton" onclick="restartServer()" disabled>Restart Server</button>
    </div>
  </div>
</div>
</body>
</html>
